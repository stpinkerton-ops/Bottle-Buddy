<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Bottle Buddy</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <style>
        /* 1. THEME & FONT DEFINITION */
        :root {
            --bg-primary: #F2F2F7; --bg-secondary: #FFFFFF; --bg-tertiary: #E9E9EB;
            --text-primary: #1D1D1F; --text-secondary: #6E6E73; --accent-color: #007AFF;
            --separator-color: #E5E5EA; --danger-color: #FF3B30;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #000000; --bg-secondary: #1C1C1E; --bg-tertiary: #2C2C2E;
                --text-primary: #F5F5F7; --text-secondary: #8E8E93; --accent-color: #0A84FF;
                --separator-color: #38383A; --danger-color: #FF453A;
            }
        }

        /* 2. GENERAL STYLES & LAYOUT */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { -webkit-font-smoothing: antialiased; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", sans-serif;
            background-color: var(--bg-primary); color: var(--text-primary);
            padding-bottom: 90px;
        }
        .container { max-width: 600px; margin: 0 auto; padding: 16px; }
        .header { display: flex; align-items: center; gap: 12px; padding: 20px 0; }
        .header img { width: 40px; height: 40px; border-radius: 8px; }
        .header h1 { font-size: 28px; font-weight: 700; margin: 0; }
        .header p { font-size: 16px; color: var(--text-secondary); margin: 2px 0 0 0; }
        h2 { font-size: 22px; font-weight: 700; margin-bottom: 16px; }

        /* 3. TAB NAVIGATION */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; height: calc(50px + env(safe-area-inset-bottom)); background-color: var(--bg-secondary); border-top: 0.5px solid var(--separator-color); display: flex; justify-content: space-around; padding-bottom: env(safe-area-inset-bottom); z-index: 1000; }
        .tab-button { background: none; border: none; color: var(--text-secondary); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 2px; font-size: 10px; cursor: pointer; flex-grow: 1; }
        .tab-button.active { color: var(--accent-color); }
        .tab-button svg { width: 24px; height: 24px; }

        /* 4. UI COMPONENTS (CARDS, BUTTONS, ETC) */
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
        .card { background-color: var(--bg-secondary); border-radius: 12px; padding: 16px; }
        .card-title { font-size: 14px; font-weight: 500; color: var(--text-secondary); margin-bottom: 8px; }
        .card-value { font-size: 28px; font-weight: 600; color: var(--text-primary); }
        .btn { display: block; width: 100%; font-size: 17px; font-weight: 600; padding: 14px; border-radius: 12px; border: none; cursor: pointer; background-color: var(--accent-color); color: white; }
        .btn-secondary { background-color: var(--bg-tertiary); color: var(--accent-color); }
        
        /* Breast Toggle */
        .breast-toggle { display: flex; background-color: var(--bg-tertiary); border-radius: 8px; padding: 4px; margin-bottom: 16px; }
        .breast-toggle button { flex: 1; padding: 8px; border: none; background-color: transparent; color: var(--text-primary); font-size: 14px; font-weight: 600; border-radius: 6px; cursor: pointer; }
        .breast-toggle button.selected { background-color: var(--bg-secondary); }
        
        /* Stopwatch & Amount Inputs */
        .stopwatch-time { font-size: 64px; font-weight: 300; text-align: center; margin: 20px 0; font-family: monospace; }
        .timer-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
        .amount-input { display: flex; align-items: center; gap: 10px; margin-top: 16px; }
        .amount-input input, .amount-input select { border-radius: 8px; background-color: var(--bg-tertiary); border: none; padding: 12px; font-size: 16px; color: var(--text-primary); }
        
        /* Diaper Counters & Severity */
        .diaper-counters { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .diaper-btn { background-color: var(--bg-secondary); border-radius: 12px; padding: 24px; text-align: center; border: none; cursor: pointer; }
        .severity-selector { display: none; margin-top: 16px; background-color: var(--bg-secondary); border-radius: 12px; padding: 16px; }
        .severity-buttons { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }
        .severity-buttons button { background-color: var(--bg-tertiary); color: var(--text-primary); }
        
        /* Log Lists */
        .log-list { margin-top: 24px; }
        .log-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 0.5px solid var(--separator-color); }
        .log-item:first-child { border-top: 0.5px solid var(--separator-color); }
        .log-details { font-size: 16px; }
        .log-time { font-size: 14px; color: var(--text-secondary); }
        
        /* Flat UI for Select dropdowns */
        select {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            padding-right: 20px;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%238E8E93' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat; background-position: right 8px center; background-size: 0.8em;
        }

        /* Original Tracker Form Styles */
        .form-section { background-color: var(--bg-secondary); border-radius: 12px; padding: 0 20px; margin-bottom: 24px; }
        .form-row { display: grid; grid-template-columns: 1fr 2fr; align-items: center; gap: 16px; min-height: 48px; border-bottom: 0.5px solid var(--separator-color); }
        .form-row:last-child { border-bottom: none; }
        /* styles continued in body */
    </style>
</head>
<body>

    <div id="homescreen-content" class="tab-content active">
        <div class="container">
            <div class="header">
                <img src="icon.png" alt="Bottle Buddy Icon">
                <div><h1>Bottle Buddy</h1><p>Track your feeds with ease</p></div>
            </div>
            <div id="summary-section"></div>
        </div>
    </div>

    <div id="feeding-content" class="tab-content">
        <div class="container">
            <h2>Log a Feed</h2>
            <div class="card">
                <div class="breast-toggle">
                    <button id="breast-left" class="selected" onclick="selectBreast('left')">Left</button>
                    <button id="breast-right" onclick="selectBreast('right')">Right</button>
                </div>
                <div class="stopwatch-time" id="stopwatchDisplay">00:00:00</div>
                <div class="timer-controls">
                    <button class="btn" id="startStopBtn">Start</button>
                    <button class="btn btn-secondary" id="resetBtn">Reset</button>
                </div>
                 <div class="amount-input">
                    <input type="number" id="bottleAmount" placeholder="Amount (optional)">
                    <select id="bottleUnit"><option>oz</option><option>ml</option></select>
                </div>
            </div>
            <button class="btn" id="logFeedBtn" style="margin-top:24px;">Log Feed</button>
            <div class="log-list" id="feedingLog"></div>
        </div>
    </div>

    <div id="tracker-content" class="tab-content">
         <div class="container">
            <h2>Schedule Events</h2>
            <div class="form-section">
                </div>
            <button class="btn" onclick="addTracker()">Create Tracker</button>
            <div id="trackersList" style="margin-top:24px;"></div>
        </div>
    </div>
    
    <div id="diaper-content" class="tab-content">
        <div class="container">
            <h2>Log a Diaper</h2>
            <div class="diaper-counters">
                <button class="diaper-btn" onclick="logDiaper('pee')">
                    <div class="emoji">ðŸ’§</div>
                    <div class="label">Pee</div>
                </button>
                 <button class="diaper-btn" onclick="showSeveritySelector()">
                    <div class="emoji">ðŸ’©</div>
                    <div class="label">Poop</div>
                </button>
            </div>
            <div class="severity-selector" id="severitySelector">
                <p style="text-align:center; color:var(--text-secondary); margin-bottom:10px;">Select Severity (3 = worst)</p>
                <div class="severity-buttons">
                    <button class="btn" onclick="logDiaper('poop', 1)">1</button>
                    <button class="btn" onclick="logDiaper('poop', 2)">2</button>
                    <button class="btn" onclick="logDiaper('poop', 3)">3</button>
                </div>
            </div>
            <div class="log-list" id="diaperLog"></div>
        </div>
    </div>

    <div class="tab-bar">
        </div>

    <script>
        // --- DATA STATE ---
        let trackers = [];
        let feedings = [];
        let diapers = [];
        let selectedBreast = 'left';

        // --- STOPWATCH STATE ---
        let stopwatchInterval = null;
        let stopwatchStartTime = 0;
        let elapsedTime = 0;

        // --- CORE APP INITIALIZATION ---
        function init() {
            // ... (previous init code)
            loadData();
            switchTab('homescreen');
            
            document.getElementById('startStopBtn').addEventListener('click', toggleStopwatch);
            document.getElementById('resetBtn').addEventListener('click', resetStopwatch);
            document.getElementById('logFeedBtn').addEventListener('click', logFeed);
        }

        // --- TAB SWITCHING LOGIC ---
        function switchTab(tabName) {
            // ... (previous switchTab code)
            if (tabName === 'feeding') renderFeedingLog();
            if (tabName === 'diaper') renderDiaperLog();
        }

        // --- TAB 1: HOMESCREEN ---
        // ... (previous renderHomescreen code)
        
        // --- TAB 2: FEEDING TRACKER ---
        function selectBreast(side) {
            selectedBreast = side;
            document.getElementById('breast-left').classList.toggle('selected', side === 'left');
            document.getElementById('breast-right').classList.toggle('selected', side === 'right');
        }

        function logFeed() {
            const amount = document.getElementById('bottleAmount').value;
            const unit = document.getElementById('bottleUnit').value;
            const duration = document.getElementById('stopwatchDisplay').textContent;

            if (!amount && duration === "00:00:00") {
                alert("Please start the timer or enter a bottle amount.");
                return;
            }

            feedings.push({
                timestamp: Date.now(),
                duration: duration,
                amount: amount || 0,
                unit: unit,
                side: selectedBreast
            });
            saveData();
            alert("Feed logged!");
            renderFeedingLog(); // Update the log on this page
            renderHomescreen(); // Update summary on homescreen
            resetStopwatch();
            document.getElementById('bottleAmount').value = '';
        }

        function renderFeedingLog() {
            const container = document.getElementById('feedingLog');
            container.innerHTML = '<h2>Recent Feedings</h2>' + feedings
                .slice() // Create a copy to sort
                .sort((a, b) => b.timestamp - a.timestamp)
                .map(feed => {
                    const time = new Date(feed.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    let details = `${feed.duration} on ${feed.side}`;
                    if (feed.amount > 0) {
                        details += ` (+ ${feed.amount} ${feed.unit} bottle)`;
                    }
                    return `
                        <div class="log-item">
                            <div class="log-details">${details}</div>
                            <div class="log-time">${time}</div>
                        </div>
                    `;
                }).join('');
        }

        // ... (stopwatch functions remain the same)

        // --- TAB 3: SCHEDULE TRACKER (code not shown for brevity) ---

        // --- TAB 4: DIAPER COUNTER ---
        function showSeveritySelector() {
            document.getElementById('severitySelector').style.display = 'block';
        }

        function logDiaper(type, severity = null) {
            const diaper = { timestamp: Date.now(), type: type };
            if (severity) {
                diaper.severity = severity;
                document.getElementById('severitySelector').style.display = 'none'; // Hide after selection
            }
            diapers.push(diaper);
            saveData();
            renderDiaperLog();
            renderDiaperSummary(); // Update the card on this page
            renderHomescreen(); // Update summary on homescreen
        }

        function renderDiaperLog() {
            const container = document.getElementById('diaperLog');
            container.innerHTML = '<h2>Recent Changes</h2>' + diapers
                .slice()
                .sort((a, b) => b.timestamp - a.timestamp)
                .map(diaper => {
                    const time = new Date(diaper.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    let details = diaper.type === 'pee' ? 'Pee ðŸ’§' : `Poop ðŸ’© (Severity: ${diaper.severity || 'N/A'})`;
                    return `
                        <div class="log-item">
                            <div class="log-details">${details}</div>
                            <div class="log-time">${time}</div>
                        </div>
                    `;
                }).join('');
        }

        // --- DATA PERSISTENCE & OTHER FUNCTIONS ---
        // ... (All other functions from previous version, not shown for brevity)

        // Add init call to the end of the script
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
